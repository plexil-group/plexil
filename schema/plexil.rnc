namespace xsi = "http://www.w3.org/2001/XMLSchema-instance"
default namespace = ""

start =
  StartCondition
  | FunctionDeclaration
  | BLOBValue
  | InOut
  | NodeBody
  | InvariantCondition
  | EQInternal
  | IsChanged
  | GlobalDeclarations
  | Node
  | NodeCommandHandleVariable
  | Concat
  | Update
  | Interface
  | EQNumeric
  | OR
  | VariableDeclarations
  | IntegerValue
  | StringValue
  | BooleanRHS
  | NodeFailureVariable
  | AND
  | PreCondition
  | Assignment
  | ArrayValue
  | NumericRHS
  | ArrayElement
  | DeclareArray
  | RepeatCondition
  | High
  | LE
  | Arguments
  | NEInternal
  | EQTime
  | SkipCondition
  | NodeTimepointValue
  | Interval
  | PostCondition
  | Command
  | EndCondition
  | LibraryNodeCall
  | StringRHS
  | NodeRef
  | Alias
  | NENumeric
  | Request
  | Timepoint
  | CommandDeclaration
  | NEBoolean
  | Low
  | LookupRHS
  | LookupNow
  | LookupOnChange
  | ResourceList
  | NodeFailureValue
  | StateDeclaration
  | ArrayRHS
  | LT
  | GT
  | LibraryNodeDeclaration
  | SQRT
  | LookupAtInterval
  | In
  | Name
  | NETime
  | Pair
  | NodeOutcomeVariable
  | GE
  | MUL
  | TimeValue
  | ABS
  | EQBoolean
  | TimeRHS
  | Tolerance
  | RealValue
  | NEString
  | XOR
  | NodeStateVariable
  | EQString
  | Resource
  | DIV
  | FunctionCall
  | SUB
  | IsKnown
  | NodeList
  | (notAllowed
     | element PlexilPlan {
         ColNo?, LineNo?, FileName?, GlobalDeclarations?, Node
       })
  | NodeStateValue
  | NOT
  | ADD
  | Parameter
  | DeclareVariable
  | BooleanValue
  | NodeCommandHandleValue
  | Return
  | NodeId
  | NodeOutcomeValue
RealValue =
  notAllowed
  | element RealValue { xsd:double }
NodeCommandHandleVariable =
  notAllowed
  | element NodeCommandHandleVariable { NodeId }
TimeValue =
  notAllowed
  | element TimeValue {
      element Units { IntegerValue },
      element SubUnits { IntegerValue }?
    }
BooleanRHS =
  notAllowed
  | element BooleanRHS { BooleanExpression }
NEString =
  notAllowed
  | element NEString { StringExpression, StringExpression }
NumericRHS =
  notAllowed
  | element NumericRHS { NumericExpression }
Resource =
  notAllowed
  | element Resource {
      element ResourceName { StringExpression }
      & element ResourcePriority { NumericExpression }
      & element ResourceLowerBound { NumericExpression }?
      & element ResourceUpperBound { NumericExpression }?
      & element ResourceReleaseAtTermination { BooleanExpression }?
    }
EQBoolean =
  notAllowed
  | element EQBoolean { BooleanExpression, BooleanExpression }
IntegerValue =
  notAllowed
  | element IntegerValue { xsd:integer }
AND =
  notAllowed
  | element AND { BooleanExpression* }
NodeCommandHandleValue =
  notAllowed
  | element NodeCommandHandleValue {
      xsd:NMTOKEN "COMMAND_ACCEPTED"
      | xsd:NMTOKEN "COMMAND_SUCCESS"
      | xsd:NMTOKEN "COMMAND_RCVD_BY_SYSTEM"
      | xsd:NMTOKEN "COMMAND_SENT_TO_SYSTEM"
      | xsd:NMTOKEN "COMMAND_FAILED"
      | xsd:NMTOKEN "COMMAND_DENIED"
    }
EQString =
  notAllowed
  | element EQString { StringExpression, StringExpression }
NumericExpression =
  ADD
  | SUB
  | MUL
  | DIV
  | SQRT
  | ABS
  | (notAllowed
     | element IntegerVariable { NCName })
  | (notAllowed
     | element RealVariable { NCName })
  | IntegerValue
  | RealValue
  | (notAllowed
     | element TimeVariable { NCName })
  | TimeValue
  | Lookup
  | NodeTimepointValue
  | (notAllowed
     | element ArraySize { NCName })
  | (notAllowed
     | element ArrayMaxSize { NCName })
  | ArrayElement
TimeExpression =
  (notAllowed
   | element TimeVariable { NCName })
  | TimeValue
  | Lookup
  | ArrayElement
BooleanValue =
  notAllowed
  | element BooleanValue { xsd:boolean }
Value =
  IntegerValue
  | RealValue
  | BooleanValue
  | StringValue
  | TimeValue
  | BLOBValue
  | ArrayValue
Parameter =
  notAllowed
  | element Parameter {
      attribute Type {
        xsd:NMTOKEN "String"
        | xsd:NMTOKEN "Time"
        | xsd:NMTOKEN "Integer"
        | xsd:NMTOKEN "Array"
        | xsd:NMTOKEN "Boolean"
        | xsd:NMTOKEN "BLOB"
        | xsd:NMTOKEN "Real"
      },
      NCNameOrEmpty
    }
DeclareVariable =
  notAllowed
  | element DeclareVariable {
      element Name { NCName },
      element Type { TypeValues },
      element InitialValue { Value }?
    }
NodeFailure = NodeFailureVariable | NodeFailureValue
TypeValues =
  xsd:NMTOKEN "String"
  | xsd:NMTOKEN "Time"
  | xsd:NMTOKEN "Integer"
  | xsd:NMTOKEN "Array"
  | xsd:NMTOKEN "Boolean"
  | xsd:NMTOKEN "BLOB"
  | xsd:NMTOKEN "Real"
Assignment =
  notAllowed
  | element Assignment {
      (DeclaredVariable+ | ArrayElement+),
      (BooleanRHS
       | NumericRHS
       | StringRHS
       | TimeRHS
       | LookupRHS
       | ArrayRHS)
    }
Low =
  notAllowed
  | element Low {
      RealValue
      | element RealVariable { NCName }
    }
Timepoint =
  notAllowed
  | element Timepoint { xsd:NMTOKEN "END" | xsd:NMTOKEN "START" }
EndCondition =
  notAllowed
  | element EndCondition { BooleanExpression }
IsKnown =
  notAllowed
  | element IsKnown {
      DeclaredVariable
      | Lookup
      | NodeStateVariable
      | NodeOutcomeVariable
      | NodeTimepointValue
    }
NCName = xsd:NCName
ColNo = attribute ColNo { xsd:integer }
StartCondition =
  notAllowed
  | element StartCondition { BooleanExpression }
SUB =
  notAllowed
  | element SUB { NumericExpression, NumericExpression }
SQRT =
  notAllowed
  | element SQRT { NumericExpression }
NodeState = NodeStateVariable | NodeStateValue
BooleanExpression =
  OR
  | XOR
  | AND
  | NOT
  | IsKnown
  | IsChanged
  | GT
  | GE
  | LT
  | LE
  | EQBoolean
  | EQNumeric
  | EQInternal
  | EQString
  | EQTime
  | NEBoolean
  | NENumeric
  | NEInternal
  | NEString
  | NETime
  | (notAllowed
     | element BooleanVariable { NCName })
  | BooleanValue
  | Lookup
  | ArrayElement
Name =
  notAllowed
  | element Name { StringExpression }
ArrayRHS =
  notAllowed
  | element ArrayRHS {
      element ArrayVariable { NCName }
    }
Concat =
  notAllowed
  | element Concat { StringExpression* }
LookupNow =
  notAllowed
  | element LookupNow {
      (Name
       | element StateName { \string }),
      Arguments?
    }
nonNegativeInteger = xsd:nonNegativeInteger
StringValue =
  notAllowed
  | element StringValue { xsd:string }
NodeFailureVariable =
  notAllowed
  | element NodeFailureVariable { NodeRef | NodeId }
DeclareArray =
  notAllowed
  | element DeclareArray {
      element Name { NCName },
      element Type { TypeValues },
      element MaxSize { nonNegativeInteger },
      (element InitialValue { AtomicValue }
       | empty
       | element FillValue { AtomicValue+ })
    }
High =
  notAllowed
  | element High {
      RealValue
      | element RealVariable { NCName }
    }
OR =
  notAllowed
  | element OR { BooleanExpression* }
SkipCondition =
  notAllowed
  | element SkipCondition { BooleanExpression }
StateDeclaration =
  notAllowed
  | element StateDeclaration { ExternalCallDeclaration }
NodeTimepointValue =
  notAllowed
  | element NodeTimepointValue {
      (NodeRef | NodeId), NodeStateValue, Timepoint
    }
Command =
  notAllowed
  | element Command {
      ResourceList?,
      DeclaredVariable*,
      (Name
       | element CommandName { \string }),
      Arguments?
    }
FunctionCall =
  notAllowed
  | element FunctionCall {
      DeclaredVariable*,
      element Name { NCName },
      Arguments?
    }
NodeRef =
  notAllowed
  | element NodeRef {
      attribute dir {
        xsd:NMTOKEN "child"
        | xsd:NMTOKEN "self"
        | xsd:NMTOKEN "sibling"
        | xsd:NMTOKEN "parent"
      }?,
      NCNameOrEmpty
    }
PostCondition =
  notAllowed
  | element PostCondition { BooleanExpression }
CommandDeclaration =
  notAllowed
  | element CommandDeclaration {
      ExternalCallDeclaration, ResourceList?
    }
LineNo = attribute LineNo { xsd:integer }
PreCondition =
  notAllowed
  | element PreCondition { BooleanExpression }
InOut =
  notAllowed
  | element InOut { (DeclareVariable | DeclareArray)+ }
TimeRHS =
  notAllowed
  | element TimeRHS { TimeExpression }
Lookup = LookupAtInterval | LookupOnChange | LookupNow
ResourceList =
  notAllowed
  | element ResourceList { Resource* }
DeclaredVariable =
  (notAllowed
   | element IntegerVariable { NCName })
  | (notAllowed
     | element RealVariable { NCName })
  | (notAllowed
     | element BooleanVariable { NCName })
  | (notAllowed
     | element StringVariable { NCName })
  | (notAllowed
     | element BLOBVariable { NCName })
  | (notAllowed
     | element TimeVariable { NCName })
  | (notAllowed
     | element ArrayVariable { NCName })
  | ArrayElement
RepeatCondition =
  notAllowed
  | element RepeatCondition { BooleanExpression }
EQInternal =
  notAllowed
  | element EQInternal {
      (NodeState, NodeState)
      | (NodeOutcome, NodeOutcome)
      | (NodeFailure, NodeFailure)
      | (NodeCommandHandle, NodeCommandHandle)
    }
Update =
  notAllowed
  | element Update { Pair* }
LibraryNodeDeclaration =
  notAllowed
  | element LibraryNodeDeclaration {
      element Name { NCName },
      element Interface {
        mixed {
          (attribute * { text }
           | element0)*
        }
      }
    }
NodeList =
  notAllowed
  | element NodeList { Node* }
EQNumeric =
  notAllowed
  | element EQNumeric { NumericExpression, NumericExpression }
GE =
  notAllowed
  | element GE { NumericExpression, NumericExpression }
Node =
  notAllowed
  | element Node {
      ColNo?,
      LineNo?,
      FileName?,
      attribute NodeType {
        xsd:NMTOKEN "FunctionCall"
        | xsd:NMTOKEN "Assignment"
        | xsd:NMTOKEN "Command"
        | xsd:NMTOKEN "Update"
        | xsd:NMTOKEN "NodeList"
        | xsd:NMTOKEN "LibraryNodeCall"
        | xsd:NMTOKEN "Empty"
        | xsd:NMTOKEN "Request"
      },
      (element Comment { \string }?
       & NodeId
       & StartCondition?
       & RepeatCondition?
       & PreCondition?
       & PostCondition?
       & InvariantCondition?
       & EndCondition?
       & SkipCondition?
       & element Priority { nonNegativeInteger }?
       & element Permissions { \string }?
       & Interface?
       & VariableDeclarations?
       & NodeBody?)
    }
XOR =
  notAllowed
  | element XOR { BooleanExpression* }
FileName = attribute FileName { xsd:string }
Arguments =
  notAllowed
  | element Arguments { (Value | DeclaredVariable)+ }
NodeOutcomeVariable =
  notAllowed
  | element NodeOutcomeVariable { NodeRef | NodeId }
AtomicValue =
  IntegerValue
  | RealValue
  | BooleanValue
  | StringValue
  | TimeValue
  | BLOBValue
ArrayValue =
  notAllowed
  | element ArrayValue { AtomicValue* }
NETime =
  notAllowed
  | element NETime { TimeExpression, TimeExpression }
LookupAtInterval =
  notAllowed
  | element LookupAtInterval {
      (Name
       | element StateName { \string }),
      Interval,
      Arguments?
    }
NENumeric =
  notAllowed
  | element NENumeric { NumericExpression, NumericExpression }
ADD =
  notAllowed
  | element ADD {
      NumericExpression, NumericExpression, NumericExpression*
    }
NodeOutcome = NodeOutcomeVariable | NodeOutcomeValue
Interval =
  notAllowed
  | element Interval { Low?, High }
NodeId =
  notAllowed
  | element NodeId { NCName }
NodeOutcomeValue =
  notAllowed
  | element NodeOutcomeValue {
      xsd:NMTOKEN "SKIPPED"
      | xsd:NMTOKEN "SUCCESS"
      | xsd:NMTOKEN "FAILURE"
    }
Return =
  notAllowed
  | element Return {
      attribute Type {
        xsd:NMTOKEN "String"
        | xsd:NMTOKEN "Time"
        | xsd:NMTOKEN "Integer"
        | xsd:NMTOKEN "Array"
        | xsd:NMTOKEN "Boolean"
        | xsd:NMTOKEN "BLOB"
        | xsd:NMTOKEN "Real"
      },
      NCNameOrEmpty
    }
NodeBody =
  notAllowed
  | element NodeBody {
      NodeList
      | Command
      | Assignment
      | FunctionCall
      | Update
      | Request
      | LibraryNodeCall
    }
ExternalCallDeclaration =
  (notAllowed
   | element Name { NCName }),
  Return*,
  Parameter*
DIV =
  notAllowed
  | element DIV { NumericExpression, NumericExpression }
ArrayElement =
  notAllowed
  | element ArrayElement {
      element Name { NCName },
      element Index { NumericExpression }
    }
LT =
  notAllowed
  | element LT { NumericExpression, NumericExpression }
NodeCommandHandle = NodeCommandHandleVariable | NodeCommandHandleValue
IsChanged =
  notAllowed
  | element IsChanged {
      element StateName { \string }
    }
ABS =
  notAllowed
  | element ABS { NumericExpression }
MUL =
  notAllowed
  | element MUL {
      NumericExpression, NumericExpression, NumericExpression*
    }
StringExpression =
  (notAllowed
   | element StringVariable { xsd:token })
  | StringValue
  | Concat
  | Lookup
  | ArrayElement
Request =
  notAllowed
  | element Request { NodeRef, Pair* }
LE =
  notAllowed
  | element LE { NumericExpression, NumericExpression }
NodeStateVariable =
  notAllowed
  | element NodeStateVariable { NodeRef | NodeId }
NOT =
  notAllowed
  | element NOT { BooleanExpression }
Pair =
  notAllowed
  | element Pair {
      element Name { NCName },
      (Value | DeclaredVariable | LookupNow)
    }
EQTime =
  notAllowed
  | element EQTime { TimeExpression, TimeExpression }
NCNameOrEmpty = xsd:NCName | xsd:string ""
Tolerance =
  notAllowed
  | element Tolerance {
      RealValue
      | element RealVariable { NCName }
      | IntegerValue
      | element IntegerVariable { NCName }
    }
element0 =
  element * {
    mixed {
      (attribute * { text }
       | element0)*
    }
  }
LibraryNodeCall =
  notAllowed
  | element LibraryNodeCall { NodeId, Alias* }
StringRHS =
  notAllowed
  | element StringRHS { StringExpression }
NEInternal =
  notAllowed
  | element NEInternal {
      (NodeState, NodeState)
      | (NodeOutcome, NodeOutcome)
      | (NodeFailure, NodeFailure)
      | (NodeCommandHandle, NodeCommandHandle)
    }
NEBoolean =
  notAllowed
  | element NEBoolean { BooleanExpression, BooleanExpression }
FunctionDeclaration =
  notAllowed
  | element FunctionDeclaration { ExternalCallDeclaration }
LookupOnChange =
  notAllowed
  | element LookupOnChange {
      (Name
       | element StateName { \string }),
      Tolerance?,
      Arguments?
    }
LookupRHS =
  notAllowed
  | element LookupRHS { Lookup }
InvariantCondition =
  notAllowed
  | element InvariantCondition { BooleanExpression }
NodeFailureValue =
  notAllowed
  | element NodeFailureValue {
      xsd:NMTOKEN "INVARIANT_CONDITION_FAILED"
      | xsd:NMTOKEN "POST_CONDITION_FAILED"
      | xsd:NMTOKEN "PRE_CONDITION_FAILED"
      | xsd:NMTOKEN "PARENT_FAILED"
    }
GT =
  notAllowed
  | element GT { NumericExpression, NumericExpression }
Alias =
  notAllowed
  | element Alias {
      element NodeParameter { NCName },
      (Value | DeclaredVariable)
    }
BLOBValue =
  notAllowed
  | element BLOBValue {
      element ExternalStructName { NCName },
      element InitialValue { integer }?
    }
integer = xsd:integer
In =
  notAllowed
  | element In { (DeclareVariable | DeclareArray)+ }
GlobalDeclarations =
  notAllowed
  | element GlobalDeclarations {
      (CommandDeclaration
       | empty
       | StateDeclaration
       | FunctionDeclaration
       | LibraryNodeDeclaration
       | element TimeScalingUnitsSubunits { integer })+
    }
VariableDeclarations =
  notAllowed
  | element VariableDeclarations { (DeclareVariable | DeclareArray)+ }
\string = xsd:string
Interface =
  notAllowed
  | element Interface { In? & InOut? }
NodeStateValue =
  notAllowed
  | element NodeStateValue {
      xsd:NMTOKEN "INACTIVE"
      | xsd:NMTOKEN "WAITING"
      | xsd:NMTOKEN "FINISHED"
      | xsd:NMTOKEN "ITERATION_ENDED"
      | xsd:NMTOKEN "EXECUTING"
      | xsd:NMTOKEN "FAILING"
      | xsd:NMTOKEN "FINISHING"
    }
PlexilPlanAttributes = 
  notAllowed
  | attribute xsi:* { xsd:anyURI }*
