#! /usr/bin/env bash

osname=`uname`
if [ "Darwin" = "$osname" ]
then
    # FIXME: sensitive to changes in output format
    netstat -anfinet | grep '^\(tcp\|udp\)' | cut -c22-44 \
        | grep -v '\*\.\*' \
        | sed -e 's/\*\.//g' \
        | sed -E -e 's/^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+\.//g'
    netstat -anfinet6 | grep '^\(tcp\|udp\)' | cut -c22-44 \
        | grep -v '\*\.\*' \
        | sed -e 's/\*\.//g' \
        | sed -E -e 's/^[0-9a-f:]*(%lo0)?\.//g'
elif [ "Linux" = "$osname" ]
then
    netstat -anAinet | grep '^\(tcp\|udp\)' | cut -c21-48 \
        | sed -E -e 's/^[0-9\.]*://g'
    # FIXME: the below not tested yet
    netstat -anAinet6 | grep '^\(tcp\|udp\)' | cut -c21-48 \
        | sed -E -e 's/^[0-9a-fA-F:]*://g'
else
    echo "Error: Don't know how to get active port list on $osname"
    exit 1
fi
