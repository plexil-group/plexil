;; File: $SVNROOT/examples/multi-exec/agents/cmd.pli

(plexil-plan
  (sequence "cmd"
    (variables (string "name" "cmd")
               (integer "period" 2)
               (integer "run-length" 20)
               (real-array "states" 4)
               (boolean "debug" true))
    (comment "Send the elapsed time since the last request in order to track state correctly")
    (for (integer "i" 0) (>= (intvar "run-length") (intvar "i")) (+ (intvar "i") (intvar "period"))
      (sequence "get-current-state"
        ;;(variables (int-array "states" 4))
        (wait (intvar "period") "Wait")
        (assignment (array-element "states" 0) 0)
        (command "print" "\n[" (stringvar "name") "] sent: get-current-state "
                 (intvar "period")" (elapsed-time: " (intvar "i") ")\n")
        (action "get-states"
          ;;(end-condition (is-known (array-element "states" 0)))
          (end-condition (not (= (array-element "states" 0) 0)))
          (command-with-return (arrayvar "states") "get-current-state" (intvar "period")))
        (command "print" "[" (stringvar "name") "] recv: " (arrayvar "states") "\n")))
    (wait 2 "Wait")
    (action "Quit"
      (command "print" "\n[" (stringvar "name") "] sent: Quit (quitting)\n")
      (command "SendMessage" "Quit"))))

;; EOF
